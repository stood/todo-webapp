<section role="region" class="vbox fit flex">
    <header>
        <a href ng-click="hideMenu(); toggleSidebar()"><span class="icon icon-menu">Menu</span></a>
        <menu type="toolbar">
            <a href ng-click="todo();"><span class="icon icon-add">Add</span></a>
        </menu>
        <h1>Todo.txt</h1>
    </header>
    <!--
    <div ng-include="'partials/alerts.html'" class="container"></div>
    -->

    <section class="gaia-list fit scroll sticky">
        <article>
            <ul>
                <li
                    id="task-{{ task.id }}"
                    class="task priority-{{ task.priority || 'none' }}"
                    ng-class="{completed: task.complete}"
                    ng-repeat="task in tasks | filter:query.toString()"
                    ng-init="hidden=false; search=true"
                    ng-click="todo()"
                >
                    {{ task.description }}

                    <span class="context" ng-repeat="context in task.contexts">
                        <a href ng-click="todo()" class="label label-success">@{{ context }}</a>
                    </span>

                    <span class="project" ng-repeat="project in task.projects">
                        <a href ng-click="todo()" class="label label-info">+{{ project }}</a>
                    </span>

                    <button ng-click="hidden=!hidden" ng-show="hasDetail(task)" title="Show detail" class="show-detail" data-icon="{{ hidden ? 'more' : 'minus'}}"></button>

                    <dl class="detail" ng-if="hasDetail(task)" ng-hide="hidden" id="task-{{ task.id }}-detail">
                        <hr />
                        <dt class="created" ng-if="task.created">Created</dt><dd>{{ task.created }}</dd>
                        <dt class="completed" ng-if="task.completed">Completed</dt><dd>{{ task.completed }}</dd>
                    </dl>
                </li>
            </ul>
        </article>
    </section>

    <footer class="gaia-footer" role="toolbar">
        <button ng-click="hideMenu(); refresh()" data-icon="sync">Sync</button>
        <button ng-click="search=true" data-icon="search">Search</button>
        <button ng-click="hideMenu(); logout()" data-icon="close">Logout</button>
    </footer>
</section>

<form ng-show="search" role="dialog" data-type="object">
    <section class="skin-dark">

        <input type="text" id="search" class="search-query form-control" placeholder="Search" ng-model="query.string" />

        <h2>Contexts</h2>
        <ul class="bb-checkbox">
            <li ng-repeat="context in contexts track by $index">
                <label>
                    <input type="checkbox" ng-model="query.contexts[$index]" />
                    <span data-icon="tick">{{ context }}</span>
                </label>
            </li>
        </ul>

        <h2>Projects</h2>
        <ul class="bb-checkbox">
            <li ng-repeat="project in projects track by $index">
                <label>
                    <input type="checkbox" ng-model="query.projects[$index]" />
                    <span data-icon="tick">{{ project }}</span>
                </label>
            </li>
        </ul>
    </section>

    <menu type="toolbar">
        <button ng-click="search=false">Cancel</button>
        <button ng-click="query.clear()" class="danger">Clear</button>
        <button ng-click="search=false" class="recommend">Ok</button>
    </menu>
</form>
